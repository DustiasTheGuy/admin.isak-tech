(()=>{"use strict";class e{constructor(e){this.serverAddr=this.getServerAddr(e),this.headers={"Content-Type":"application/json"},console.log(this.serverAddr)}getServerAddr(e){return e?"https://admin.isak-tech.tk":"http://localhost:8084"}GET(e,t){return t?fetch(e,{method:"GET",headers:this.headers}).then((e=>e.json())):fetch(this.serverAddr+e,{method:"GET",headers:this.headers}).then((e=>e.json()))}POST(e,t){return fetch(this.serverAddr+e,{method:"POST",headers:this.headers,body:JSON.stringify(t)}).then((e=>e.json()))}}const t=e=>alert(e),n=e=>e.path[0].value.length<=0,s=e=>{let t=document.getElementById(e);return t.classList.contains("open")?t.classList.remove("open"):t.classList.add("open")},a=e=>{switch(typeof e){case"number":break;case"string":e=+new Date(e);break;case"object":e.constructor===Date&&(e=e.getTime());break;default:e=+new Date}var t=[[60,"seconds",1],[120,"1 minute ago","1 minute from now"],[3600,"minutes",60],[7200,"1 hour ago","1 hour from now"],[86400,"hours",3600],[172800,"Yesterday","Tomorrow"],[604800,"days",86400],[1209600,"Last week","Next week"],[2419200,"weeks",604800],[4838400,"Last month","Next month"],[29030400,"months",2419200],[58060800,"Last year","Next year"],[290304e4,"years",29030400],[580608e4,"Last century","Next century"],[580608e5,"centuries",290304e4]],n=(+new Date-e)/1e3,s="ago",a=1;if(0==n)return"Just now";n<0&&(n=Math.abs(n),s="from now",a=2);for(var r,o=0;r=t[o++];)if(n<r[0])return"string"==typeof r[2]?r[a]:Math.floor(n/r[2])+" "+r[1]+" "+s;return e};let r=new e(!0);const o=e=>{try{if(confirm("Confirm Delete Image: "+e.id))return r.GET("/site/main/post/"+e.postid+"/"+e.id+"/remove-image").then((e=>e.success?window.location.reload():t(e.message)))}catch(e){return}},d=e=>{if(confirm("Confirm Delete Page "+e))return window.location.pathname="/site/portal/page/"+e+"/delete"};class i{constructor(){this.thead=document.getElementById("t-head")}init(){this.addEventListeners(),this.fixDates()}fixDates(){let e=document.getElementsByClassName("created");for(let t=0;t<e.length;t++)e[t].textContent=a(new Date(e[t].textContent))}addEventListeners(){this.thead.childNodes.forEach((e=>{e.addEventListener("mouseenter",(e=>{let t=e.target.textContent.replace(/\s/g,"").toLowerCase(),n=document.getElementsByClassName(t);for(let e=0;e<n.length;e++)n[e].classList.add("active")})),e.addEventListener("mouseleave",(e=>{let t=e.target.textContent.replace(/\s/g,"").toLowerCase(),n=document.getElementsByClassName(t);for(let e=0;e<n.length;e++)n[e].classList.remove("active")}))}))}}class l{constructor(){this.apiContainer=document.getElementById("api-container"),this.APIRoutes=[{path:"/api/posts",method:"GET",data:null},{path:"/api/post/:id",method:"GET",data:null},{path:"/api/paginate/:page/:limit",method:"GET",data:null},{path:"/api/delete",method:"DELETE",data:{id:"uint64"}},{path:"/api/new",method:"POST",data:{title:"string",body:"string",tags:"[]string"}},{path:"/api/update",method:"PUT",data:{id:"uint64",title:"string",body:"string",tags:"[]string"}}]}init(){this.render()}render(){this.APIRoutes.forEach((e=>{let t=document.createElement("div");t.classList.add("api-route"),t.innerHTML=`\n                <div>\n                    <span>${e.path}</span>\n                    <span>${e.method}</span>\n                </div>\n                <pre>${null!=e.data?JSON.stringify(e.data,null,2):"No data required"}</pre>\n            `,this.apiContainer.appendChild(t)}))}}let c=new e(!0);class m{constructor(e){this.data=e,this.container=document.getElementsByClassName("table-body")[0]}init(){this.loadData()}loadData(){c.GET("https://paste.isak-tech.tk/analytics/load/load_all",!0).then((e=>e.success?this.render(e.data):console.log(e.message)))}render(e){e.forEach((e=>{let t=document.createElement("div");t.className="table-row",t.innerHTML=`\n                <span class="id">${e.id}</span>\n                <span class="href">${e.href}</span>\n                <span class="created">${e.created}</span>\n                <span class="ip">${e.ip}</span>\n            `,this.container.appendChild(t)})),(new i).init()}}let u=new e(!0);class p{constructor(){this.processes=document.getElementById("processes"),this.placeholders=document.getElementsByClassName("placeholder"),this.adminLevel=document.getElementById("admin_level").value}init(){this.loadData();try{document.getElementsByClassName("btn-primary")[0].addEventListener("click",(()=>this.startProcess()))}catch(e){console.log("Administration level too low")}}loadData(){return u.GET("/users/get-processes").then((e=>e.success&&null!=e.data?e.data.map((e=>this.render({Service:e.Service,Config:e.Config}))):console.log("err")))}stopProcess(e){if(confirm("Are you sure you wish to terminate process: "+e))return u.GET("/users/stop/"+e).then((t=>{t.success&&document.getElementById("processes").removeChild(document.getElementById("p-"+e))}))}startProcess(){let e=document.getElementById("server").value;return u.GET("/users/start/"+e).then((e=>e.success?this.render(e.data):t(e.message)))}render(e){let t=document.createElement("div");return t.classList.add("process"),t.id="p-"+e.Service.ProcessID,t.innerHTML=`\n        <div class="process-body">\n            <p><span>Process Label:</span><span>${e.Service.Label}</span></p>\n            <p><span>Process ID:</span><span>${e.Service.ProcessID}</span></p>\n            <p><span>Server Address:</span><span><a href="${e.Config.ServerAddr}" target="_blank">${e.Config.ServerAddr}</a></span></p>\n            <p><span>Domain:</span><span><a href="${e.Config.Domain}" target="_blank">${e.Config.Domain}</a></span></p>\n            <p><span>Started:</span><span>${a(new Date(e.Service.Started))}</span></p>\n        </div>\n    \n        <div class="process-footer">\n            ${this.processFooter({adminLevel:parseInt(this.adminLevel),pid:e.Service.ProcessID})}\n        </div>`,this.processes.appendChild(t),document.getElementById("btn-"+e.Service.ProcessID).addEventListener("click",(()=>this.stopProcess(e.Service.ProcessID))),null}processFooter(e){return e.adminLevel>=3?`    \n        <a class="terminate" href="javascript:void(0)" id="btn-${e.pid}">Terminate</a>\n        <a href="#">Restart</a>`:""}}const h=()=>{(()=>{let e=document.getElementsByClassName("nav-link");for(let t=0;t<e.length;t++)if(e[t].href===window.location.href)return e[t].classList.add("active")})(),document.getElementById("navbar-btn").addEventListener("click",(()=>(s("sidenav"),s("navbar-btn"),void s("content-main")))),(()=>{try{let e=document.getElementById("adminLevel").value,t=document.getElementById("admin");for(let n=0;n<t.length;n++)t[n].value===e&&(t[n].selected=!0)}catch(e){return}})(),(()=>{try{let e=document.getElementsByClassName("alert");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>{e[t].style.display="none"}))}catch(e){return}})(),(()=>{let e=document.getElementsByClassName("form-group");for(let t=0;t<e.length;t++)e[t].childNodes.forEach((n=>{("INPUT"===n.tagName||"SELECT"===n.tagName||"TEXTAREA"===n.tagName)&&n.value.length>0&&e[t].classList.add("focused")})),e[t].addEventListener("focusin",(e=>e.path[1].classList.add("focused"))),e[t].addEventListener("focusout",(e=>n(e)?e.path[1].classList.remove("focused"):""))})(),(()=>{try{let e=document.getElementById("post-category").textContent,t=document.getElementsByTagName("option");for(let n=0;n<t.length;n++)if(t[n].value===e)return t[n].selected=!0}catch(e){return}})(),(()=>{try{document.getElementById("archived").checked=1===parseInt(document.getElementById("archived-hidden").textContent)}catch(e){return}})(),(()=>{try{let e=document.getElementsByClassName("gallery-item");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>o({id:e[t].getAttribute("data-id"),postid:e[t].getAttribute("data-postid")})))}catch(e){return}})(),(()=>{try{let e=document.getElementById("delete"),n=document.getElementById("save");e.addEventListener("click",(()=>(e=>{if(confirm("Confirm Delete Post "+e))return window.location.pathname="/site/main/post/"+e+"/remove-post"})(e.getAttribute("data-id")))),n.addEventListener("click",(()=>(()=>{let e={ID:parseInt(document.getElementById("post-id").textContent),Title:document.getElementById("title").value,Post:document.getElementById("body").value,Category:document.getElementById("category").value||"Articles",Thumbnail:document.getElementById("thumbnail").value,Archived:document.getElementById("archived").checked?1:0};confirm("Confirm Update")&&r.POST("/site/main/post/"+e.ID,e).then((e=>e.success?window.location.href="/site/main":t(e.message)))})()))}catch(e){return}})(),(()=>{try{let e=document.getElementsByClassName("delete_page");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(()=>d(e[t].getAttribute("data-id"))))}catch(e){return}})()};window.document.onload=(()=>{switch(h(),window.location.pathname){case"/users/management":return(new p).init();case"/site/paste/api":return(new l).init();case"/site/main":case"/users/user_accounts":case"/site/portal":return(new i).init();case"/users/analytics":return(new m).init();case"/sign-in":return document.getElementsByClassName("btn-primary")[0].addEventListener("click",(()=>(()=>{let e=document.getElementById("signIn-form"),n=new FormData(e),s=document.getElementById("username").value,a=document.getElementById("password").value;r.POST("/validate-form/sign-in",{username:s,password:a}).then((r=>r.success?(n.append("username",s),n.append("password",a),e.submit()):t(r.message)))})()));case"/sign-up":return document.getElementsByClassName("btn-primary")[0].addEventListener("click",(()=>(()=>{let e=document.getElementById("signUp-form"),n=new FormData(e),s=document.getElementById("email").value,a=document.getElementById("username").value,o=document.getElementById("password").value;r.POST("/validate-form/sign-up",{email:s,username:a,password:o}).then((r=>(console.log(r),r.success?(n.append("email",s),n.append("username",a),n.append("password",o),e.submit()):t(r.message))))})()));default:return}})()})();